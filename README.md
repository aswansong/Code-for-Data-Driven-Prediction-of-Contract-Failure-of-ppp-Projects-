# PPP项目合同失败预测

本项目是对论文 **《数据驱动的政府与社会资本合作项目合同失败预测》（"Data-Driven Prediction of Contract Failure of Public-Private Partnership Projects"）** 中所提方法的代码复现。该论文由 Yongqi Wang, Zhe Shao, 和 Robert L. K. Tiong 撰写。项目利用机器学习模型，基于项目特定和国家宏观两个层面的因素，来预测PPP（政府与社会资本合作）项目的最终状态（成功或失败）。

## 项目简介

PPP模式是大型基础设施项目常用的采购模式，但其合同失败的风险也相对较高。本项目的目标是复现一种数据驱动的方法，用于主动预测这些潜在的失败风险。

该方法论包含几个关键阶段：
1.  **数据收集与整合**：收集并合并来自世界银行三大数据库（PPI, WGI, WDI）的数据。
2.  **数据预处理**：对合并后的数据集进行清洗，处理缺失值，并将分类特征转换为适用于机器学习的数值格式。
3.  **模型训练与评估**：在数据集上训练多种机器学习模型，包括逻辑回归（LR）、支持向量机（SVM）和随机森林（RF）。由于原始数据集高度不平衡，我们采用SMOTE（合成少数类过采样技术）等方法来平衡训练数据。
4.  **结果分析**：评估各模型的性能，并使用主成分分析（PCA）和特征重要性分析来识别导致合同失败的最关键因素。

本代码库包含了执行以上步骤所需的Python代码和Jupyter Notebook。

### 引用原始论文
如果您在研究中使用了本项目，请引用原始论文：

> Wang, Y., Shao, Z., & Tiong, R. L. K. (2021). Data-Driven Prediction of Contract Failure of Public-Private Partnership Projects. *Journal of Construction Engineering and Management, 147*(8), 04021089. DOI: 10.1061/(ASCE)CO.1943-7862.0002124

## 数据来源

本分析基于三个公开数据库的数据：
* **基础设施中的私人参与 (PPI) 数据库**: 提供1990年至2022年间超过9,000个项目的特定数据，包括合同类型、投资额、所属行业和项目状态等。
* **全球治理指标 (WGI)**: 包含各国的制度和法律因素，如腐败控制、法治水平和政治稳定性等。
* **世界发展指标 (WDI)**: 提供宏观经济因素，如GDP、通货膨胀（GDP平减指数）和预期寿命等。

## 方法论

整个流程分为两个主要部分：数据预处理和模型训练。

### 1. 数据预处理 (`data_explain.ipynb` & `data_ana.ipynb`)

这两个Jupyter Notebook文件负责完成繁杂的数据准备工作：
1.  **加载与合并**: 将多个Excel文件（`1990-2000.xlsx`, `2001-2011.xlsx`, `2012-2022.xlsx`）加载并合并成一个单一的DataFrame。
2.  **处理缺失值**: 使用自定义函数 `trainsform_float` 来填充缺失的数值数据。它会将"Not Available"或"Not Applicable"的条目替换为相应列的平均值（四舍五入）。
3.  **特征转换**: 将分类变量转换为数值表示：
    * 像 `IncomeGroup`（收入水平）这样的有序变量被映射到数值尺度（例如，低收入 -> 0, 中低收入 -> 1, 中高收入 -> 2）。
    * 像 `UnsolicitedProposal`（主动竞标）这样的二元变量（'Yes'/'No'）被转换为0/1。
    * `Project status`（项目状态）被转换为二元目标变量，其中'Active'（活跃）和'Concluded'（已完成）被视为成功（0），而'Cancelled'（已取消）和'Distressed'（陷入困境）被视为失败（1）。
4.  **特征工程**: 创建新特征，例如发起人数量（`Sponsors`）和项目是否涉及外国发起人（`Sponsors Country`）。
5.  **外部数据整合**: 根据项目的所在国和财务交割年份，将治理指标（WGI）和宏观经济指标（WDI）合并到主数据集中。

### 2. 模型训练与评估 (`LR.py`, `SVM.py`, `RF.py`)

这些Python脚本为三个主要行业（**能源**、**交通**、**水务**）实现了机器学习流程。
1.  **数据划分**: 将每个行业的数据集划分为训练集和测试集。
2.  **归一化与PCA**: 使用 `StandardScaler` 对特征进行标准化，以消除尺度偏差。然后应用主成分分析（PCA）进行降维，通过创建不相关的主成分来提升模型性能。
3.  **数据平衡**: 使用 **SMOTE** 对高度不平衡的训练数据进行过采样，以合成少数类（失败项目）的样本。
4.  **模型拟合**: 在预处理后的数据上训练三个模型：
    * **逻辑回归 (`LR.py`)**: 作为基准的线性模型。
    * **支持向量机 (`SVM.py`)**: 寻找一个最优超平面来区分不同类别的模型。
    * **随机森林 (`RF.py`)**: 由多个决策树组成的集成模型，提供稳健且准确的预测。
5.  **模型评估**: 使用适用于不平衡分类的指标在未见过的测试集上评估模型，包括 **召回率（Recall）**、**精确率（Precision）**、**F1分数（F1-Score）** 和 **ROC曲线下面积（AUC）**。

## 结果

本次复现的结果验证了原始论文的发现，证明了机器学习可以有效地预测PPP项目的合同失败。

### 模型性能

随机森林模型与SMOTE的组合通常表现最佳，尤其是在交通和水务领域。原论文中达到的关键性能指标如下：

| 行业 | 最佳模型 (基于AUPRC) | 召回率 (Recall) | 准确率 (Accuracy) | AUC |
| :--- | :--- | :--- | :--- | :--- |
| **交通** | RF + SMOTE | 75.9% | 86.7% | 0.91|
| **水务** | RF + SMOTE | 73.3% | 81.7% | 0.85|
| **能源** | LR + SMOTE | 76.2% | 86.9% | 0.86|

### 关键失败因素

分析揭示了几个在不同行业中都非常重要的共同因素：
* **总投资额 (PF7) & 项目容量 (PF5)**: 项目规模越大、越复杂，风险越高。
* **合同期 (PF1)**: 合同期限越长，项目面临的不确定性就越多，失败风险也随之增加。
* **发起人数量 (PF20)**: 发起人数量过多可能导致协调困难和利益冲突。
* **CPI (CF3 - 通货膨胀)**: 高通胀会增加项目成本，侵蚀收入的实际价值，从而威胁到项目的可行性。

`tree.dot` 文件提供了随机森林模型中单个决策树的可视化表示，展示了模型如何利用不同因素进行预测。

## 如何使用本项目

### 环境要求
您需要Python 3以及以下库：
- pandas
- scikit-learn
- imblearn (用于SMOTE)
- matplotlib
- pydot
- numpy

您可以使用pip进行安装：
```bash
pip install pandas scikit-learn imbalanced-learn matplotlib pydot numpy
```

### 运行代码
1.  **数据准备**:
    * 将原始数据文件（如 `1990-2000.xlsx`, `wgidataset.xlsx` 等）放置在Notebook引用的相应目录中。
    * 依次运行 `data_explain.ipynb` 和 `data_ana.ipynb` 来处理原始数据。这将生成一个 `final2.csv` 文件，它是用于建模的、经过清洗和合并的数据集。
2.  **模型训练**:
    * 运行模型脚本：
        ```bash
        python RF.py
        python LR.py
        python SVM.py
        ```
    * 这些脚本将为每个行业训练模型，在控制台打印评估指标，并生成ROC曲线、PR曲线和混淆矩阵的图表。`RF.py` 脚本还会为决策树生成 `.dot` 可视化文件。

## 文件说明

* `1.pdf`: Wang, Shao, and Tiong (2021) 的原始研究论文。
* `data_explain.ipynb`: 用于初始数据加载、清洗和转换的Jupyter Notebook。
* `data_ana.ipynb`: 用于进一步特征工程和数据整合的Jupyter Notebook。
* `LR.py`: 实现、训练和评估逻辑回归模型的Python脚本。
* `SVM.py`: 实现、训练和评估支持向量机模型的Python脚本。
* `RF.py`: 实现、训练和评估随机森林模型的Python脚本。
* `tree.dot`: 随机森林分类器中单个决策树结构的可视化输出示例文件。
* `*.xlsx`, `*.csv`: 项目使用的数据文件。（注意：为完整复现，请确保您拥有来自原始数据源的全部数据）。
